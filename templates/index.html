{% extends "base.html" %}
{% block title %}üìÅ Multiagent System ‚Äî –ö–∞—Ç–∞–ª–æ–≥–∏{% endblock %}
{% block content %}

<header class="page-header">
  <h1>–ö–∞—Ç–∞–ª–æ–≥–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>
  <p class="subtitle">
    –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∞–≥–µ–Ω—Ç–∞–º–∏, –Ω–∞–∑–Ω–∞—á–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
  </p>

  <div class="top-actions">
    <button id="open-folder-modal" class="neon-button">üìÅ –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button>
    <button id="open-agent-modal" class="neon-button">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
  </div>

</header>


<div id="folderMessage" class="message"></div>
<!-- === –ö–∞—Ç–∞–ª–æ–≥–∏ === -->
<section id="folders-container">
  {% set folders = folders or {} %}
  {% for folder, agents in folders.items() %}
  <section id="folder-{{ folder }}" class="folder" data-folder="{{ folder }}">
    <div class="folder-header">
      <div class="left-side">
        <i data-lucide="folder"></i>
        <h2 class="folder-title" onclick="AIManager.toggleFolder('{{ folder }}')">{{ folder }}</h2>
      </div>
      <div class="right-side">
        <div class="folder-actions">
          <button class="delete-folder-btn" onclick="AIManager.deleteFolder('{{ folder }}')">
            <i data-lucide="trash-2"></i>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
          </button>
        </div>
      </div>

    </div>

    <!-- –í–≤–æ–¥ –∑–∞–¥–∞—á–∏ -->
    <div class="task-box hidden" id="task-box-{{ folder }}">
      <textarea id="task-input-{{ folder }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ '{{ folder }}'..."></textarea>
      <button onclick="AIManager.assignTaskToFolder('{{ folder }}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ -->
    <ul class="agents-list" id="agents-{{ folder }}" style="display:none;">
      {% if agents %}
        {% for a in agents %}
        <li>
          <a href="/agent/{{ a.slug }}">{{ a.name }}</a>
          <button onclick="AIManager.deleteAgent('{{ a.slug }}', '{{ folder }}')">–£–¥–∞–ª–∏—Ç—å</button>
        </li>
        {% endfor %}
      {% else %}
        <li><em>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</em></li>
      {% endif %}
    </ul>
  </section>
  {% endfor %}
</section>

<!-- === –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ === -->
<section class="ai-agents">
  <ul></ul>
</section>

<div id="agent-modal" class="modal-overlay" style="display:none;">
  <div class="modal-content" id="create-agent-modal">
    <h2>üë§ –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h2>
    <form id="create-agent-form">
      <label>–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
      <input type="text" name="name" id="agent-name" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏—Ç–∏–∫" required>
      <div id="agent-name-error" class="form-error"></div>

      <label>–û–ø–∏—Å–∞–Ω–∏–µ (—Ä–æ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞):</label>
      <textarea name="prompt" id="agent-prompt" placeholder="–û–ø–∏—à–∏ —Ä–æ–ª—å –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..."></textarea>
      

      <label>–ö–∞—Ç–∞–ª–æ–≥:</label>
      <select name="folder" id="folder-select" required>
        <option value="root">root</option>
      </select>

      <label>üß≠ –°—Ç–∏–ª—å –º—ã—à–ª–µ–Ω–∏—è:</label>
      <input type="range" id="team-bias" name="team_bias" min="0" max="1" step="0.1" value="0.5">
      <div class="range-labels">
        <span>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏—Å—Ç</span>
        <span>–ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–≥—Ä–æ–∫</span>
      </div>

      <label>Telegram Token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
      <input type="text" name="telegram_token" id="telegram-token" placeholder="1234567890:ABC-XYZ...">

      <div class="modal-buttons">
        <button type="submit" id="create-agent-btn">‚ûï –°–æ–∑–¥–∞—Ç—å</button>
        <button type="button" id="close-agent-modal" class="cancel">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <div id="agent-message" class="form-message"></div>
    </form>
  </div>
</div>


{% endblock %}
