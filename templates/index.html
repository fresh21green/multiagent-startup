{% extends "base.html" %}
{% block title %}üìÅ Multiagent System ‚Äî –ö–∞—Ç–∞–ª–æ–≥–∏{% endblock %}
{% block content %}

<header class="page-header">
  <h1>–ö–∞—Ç–∞–ª–æ–≥–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>
  <p class="subtitle">
    –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∞–≥–µ–Ω—Ç–∞–º–∏, –Ω–∞–∑–Ω–∞—á–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
  </p>

  <div class="top-actions">
    <button id="open-agent-modal" class="neon-button">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
  </div>

</header>


<div id="folderMessage" class="message"></div>
<!-- === –ö–∞—Ç–∞–ª–æ–≥–∏ === -->
<section id="folders-container">
  {% for folder, agents in folders.items() %}
  <section id="folder-{{ folder }}" class="folder" data-folder="{{ folder }}">
    <div class="folder-header">
      <h2 class="folder-title" onclick="AIManager.toggleFolder('{{ folder }}')">{{ folder }}</h2>
      <div class="folder-actions">
        <button class="assign-btn" onclick="toggleTaskBox('{{ folder }}')">
          <i data-lucide="rocket"></i> –ó–∞–¥–∞—Ç—å –∑–∞–¥–∞—á—É
        </button>
        <button class="delete-folder-btn" onclick="AIManager.deleteFolder('{{ folder }}')">
          <i data-lucide="trash-2"></i> –£–¥–∞–ª–∏—Ç—å
        </button>
      </div>
    </div>

    <!-- –í–≤–æ–¥ –∑–∞–¥–∞—á–∏ -->
    <div class="task-box hidden" id="task-box-{{ folder }}">
      <textarea id="task-input-{{ folder }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ '{{ folder }}'..."></textarea>
      <button onclick="assignTaskToFolder('{{ folder }}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ -->
    <ul class="agents-list" id="agents-{{ folder }}" style="display:none;">
      {% if agents %}
        {% for a in agents %}
        <li>
          <a href="/agent/{{ a.slug }}">{{ a.name }}</a>
          <button onclick="AIManager.deleteAgent('{{ a.slug }}', '{{ folder }}')">–£–¥–∞–ª–∏—Ç—å</button>
        </li>
        {% endfor %}
      {% else %}
        <li><em>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</em></li>
      {% endif %}
    </ul>
  </section>
  {% endfor %}
</section>

<!-- === –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ === -->
<section class="ai-agents">
  <ul></ul>
</section>

<div id="agent-modal" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <h2>üë§ –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h2>
    <form id="create-agent-form">
      <label>–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
      <input type="text" name="name" id="agent-name" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏—Ç–∏–∫" required>
      <div id="agent-name-error" class="form-error"></div>

      <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
      <textarea name="description" id="agent-desc" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ —Ä–æ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..."></textarea>

      <label>–ö–∞—Ç–∞–ª–æ–≥:</label>
      <select name="folder" id="folder-select" required>
        <option value="root">root</option>
      </select>

      <label>Telegram Token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
      <input type="text" name="telegram_token" id="telegram-token" placeholder="1234567890:ABC-XYZ...">

      <div class="modal-buttons">
        <button type="submit" id="create-agent-btn">‚ûï –°–æ–∑–¥–∞—Ç—å</button>
        <button type="button" id="close-agent-modal" class="cancel">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <div id="agent-message" class="form-message"></div>
    </form>
  </div>
</div>


{% endblock %}
