<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Multiagent System{% endblock %}</title>
  <link id="themeStylesheet" rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/markdown.css">
  <link id="themeStylesheet" rel="stylesheet" href="/static/themes/command_center.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://unpkg.com/d3@7/dist/d3.min.js"></script>
  <script src="https://unpkg.com/force-graph"></script>
  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
  <aside class="sidebar">
    <h2>AI Command Center</h2>
    <nav>
        <a href="/" {% if active == 'index' %}class="active"{% endif %}>
            <i data-lucide="folder"></i> –ö–∞—Ç–∞–ª–æ–≥–∏
        </a>
        <a href="/office" {% if active == 'office' %}class="active"{% endif %}>
            <i data-lucide="briefcase"></i> –û—Ñ–∏—Å
        </a>
        <a href="/context" {% if active == 'memory' %}class="active"{% endif %}>
            <i data-lucide="cpu"></i> –ü–∞–º—è—Ç—å
        </a>
        <a href="/checklist" {% if active == 'checklist' %}class="active"{% endif %}>
            <i data-lucide="check-square"></i> –ß–µ–∫–ª–∏—Å—Ç
        </a>
    </nav>

    <div class="theme-toggle">
      <button onclick="setTheme('command_center')">Dark</button>
      <button onclick="setTheme('light')">Light</button>
    </div>
  </aside>

  <main class="main-content">
     <!-- === üß† –í–µ—Ä—Ö–Ω–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ç—É—Å === -->
    <div class="status-bar-wrap">
        <div id="system-status-bar" class="system-status">
            <!-- <span id="system-status-icon">üß†</span> -->
            <span id="system-status-text">üß† –í—Å–µ –∞–≥–µ–Ω—Ç—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
        </div>

        <div class="auth-block">
          <div id="user-info"></div>
          <button id="logoutBtn" class="sp-btn">üö™ –í—ã–π—Ç–∏</button>
        </div>
    </div>
    {% block content %}{% endblock %}
  </main>

  <div id="results-modal" class="modal">
    <div class="modal-content">
      <span id="close-results-modal" class="close">&times;</span>
      <h3>üßæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏</h3>
      <div id="results-content"></div>
    </div>
  </div>
  <script src="/static/js/auth.js"></script>
  <script src="/static/js/core.js"></script>
  <script src="/static/js/office.js"></script>
  <script src="/static/js/brainstorm.js"></script>
  {% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const slug = window.location.pathname.split("/").pop();
  const token = localStorage.getItem("token");

  if (!token) {
    console.warn("–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ /login");
    window.location.href = "/login";
    return;
  }

  const nameEl = document.querySelector("#agent-name");
  const folderEl = document.querySelector("#agent-folder");
  const promptEl = document.querySelector("#agent-prompt");
  const statusEl = document.querySelector("#agent-status-text");

  try {
    const res = await fetch(`/api/agent/${slug}`, {
      headers: {
        "Authorization": `Bearer ${token}`,
        "Accept": "application/json"
      }
    });

    if (!res.ok) {
      const errText = await res.text();
      throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (${res.status}): ${errText}`);
    }

    const data = await res.json();
    console.log("‚úÖ –ê–≥–µ–Ω—Ç:", data);

    nameEl.textContent = data.name || "–ë–µ–∑ –∏–º–µ–Ω–∏";
    folderEl.textContent = `üìÅ –ö–∞—Ç–∞–ª–æ–≥: ${data.folder || "root"}`;
    promptEl.textContent = data.prompt || "(–ü—Ä–æ–º–ø—Ç –Ω–µ –∑–∞–¥–∞–Ω)";
    statusEl.textContent = `–°—Ç–∞—Ç—É—Å: ${data.status || "ready"}`;
  } catch (err) {
    console.error(err);
    nameEl.textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≥–µ–Ω—Ç–∞";
    promptEl.textContent = "(–¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã)";
    statusEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
  }
});




  const saveBtn = document.getElementById("save-agent-btn");
  const promptField = document.getElementById("agent-prompt");
  const teamSlider = document.getElementById("team-bias");
  const status = document.getElementById("save-status");

  const slug = window.location.pathname.split("/").pop();


</script>
{% endblock %}

</body>
</html>
